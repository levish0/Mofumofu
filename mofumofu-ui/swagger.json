{
	"openapi": "3.1.0",
	"info": {
		"title": "mofumofu_server",
		"description": "mofumofu_server",
		"contact": {
			"name": "Levi Laine",
			"email": "shiueo.csh@gmail.com"
		},
		"license": {
			"name": ""
		},
		"version": "2.1.1"
	},
	"paths": {
		"/health-check": {
			"get": {
				"tags": ["Health"],
				"operationId": "health_check",
				"responses": {
					"204": {
						"description": "Service is healthy and running"
					},
					"500": {
						"description": "Internal server error"
					}
				}
			}
		},
		"/v0/action-logs": {
			"get": {
				"tags": ["Action Logs"],
				"operationId": "get_action_logs",
				"parameters": [
					{
						"name": "cursor_id",
						"in": "query",
						"description": "Cursor ID for pagination. None means get latest.",
						"required": false,
						"schema": {
							"type": "string",
							"format": "uuid"
						}
					},
					{
						"name": "cursor_direction",
						"in": "query",
						"description": "Cursor direction (default: Older when cursor_id is provided)",
						"required": false,
						"schema": {
							"$ref": "#/components/schemas/CursorDirection"
						}
					},
					{
						"name": "limit",
						"in": "query",
						"description": "Number of items to return (max: 100)",
						"required": true,
						"schema": {
							"type": "integer",
							"format": "int64",
							"minimum": 0
						}
					},
					{
						"name": "user_id",
						"in": "query",
						"description": "Filter by user ID (for contributions)",
						"required": false,
						"schema": {
							"type": "string",
							"format": "uuid"
						}
					},
					{
						"name": "resource_id",
						"in": "query",
						"description": "Filter by resource ID",
						"required": false,
						"schema": {
							"type": "string",
							"format": "uuid"
						}
					},
					{
						"name": "resource_type",
						"in": "query",
						"description": "Filter by resource type",
						"required": false,
						"schema": {
							"$ref": "#/components/schemas/ActionResourceType"
						}
					},
					{
						"name": "actions",
						"in": "query",
						"description": "Filter by actions",
						"required": false,
						"schema": {
							"type": "array",
							"items": {
								"$ref": "#/components/schemas/ActionLogAction"
							}
						}
					}
				],
				"responses": {
					"200": {
						"description": "Action logs retrieved successfully",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ActionLogListResponse"
								}
							}
						}
					},
					"400": {
						"description": "Bad request - Invalid query parameters or validation error"
					},
					"500": {
						"description": "Internal Server Error - Database error"
					}
				}
			}
		},
		"/v0/auth/change-email": {
			"post": {
				"tags": ["Auth"],
				"operationId": "auth_change_email",
				"requestBody": {
					"content": {
						"application/json": {
							"schema": {
								"$ref": "#/components/schemas/ChangeEmailRequest"
							}
						}
					},
					"required": true
				},
				"responses": {
					"204": {
						"description": "Verification email sent to new address"
					},
					"400": {
						"description": "Bad request - Invalid JSON, validation error, or incorrect password"
					},
					"401": {
						"description": "Unauthorized - Invalid or expired session"
					},
					"500": {
						"description": "Internal Server Error"
					}
				},
				"security": [
					{
						"session_id_cookie": []
					}
				]
			}
		},
		"/v0/auth/change-password": {
			"post": {
				"tags": ["Auth"],
				"operationId": "auth_change_password",
				"requestBody": {
					"content": {
						"application/json": {
							"schema": {
								"$ref": "#/components/schemas/ChangePasswordRequest"
							}
						}
					},
					"required": true
				},
				"responses": {
					"204": {
						"description": "Password changed successfully"
					},
					"400": {
						"description": "Bad request - Invalid JSON, validation error, or incorrect password"
					},
					"401": {
						"description": "Unauthorized - Invalid or expired session"
					},
					"500": {
						"description": "Internal Server Error"
					}
				},
				"security": [
					{
						"session_id_cookie": []
					}
				]
			}
		},
		"/v0/auth/complete-signup": {
			"post": {
				"tags": ["Auth"],
				"summary": "OAuth pending signup을 완료합니다.",
				"description": "OAuth 로그인 시 신규 사용자인 경우 반환된 pending_token과 함께\nhandle을 제출하여 가입을 완료합니다.",
				"operationId": "auth_complete_signup",
				"requestBody": {
					"content": {
						"application/json": {
							"schema": {
								"$ref": "#/components/schemas/CompleteSignupRequest"
							}
						}
					},
					"required": true
				},
				"responses": {
					"204": {
						"description": "Signup completed successfully"
					},
					"400": {
						"description": "Bad request - Invalid JSON or validation error"
					},
					"401": {
						"description": "Unauthorized - Token expired or invalid"
					},
					"409": {
						"description": "Conflict - Handle or email already exists"
					},
					"500": {
						"description": "Internal Server Error - Database or Redis error"
					}
				}
			}
		},
		"/v0/auth/confirm-email-change": {
			"post": {
				"tags": ["Auth"],
				"operationId": "auth_confirm_email_change",
				"requestBody": {
					"content": {
						"application/json": {
							"schema": {
								"$ref": "#/components/schemas/ConfirmEmailChangeRequest"
							}
						}
					},
					"required": true
				},
				"responses": {
					"204": {
						"description": "Email changed successfully"
					},
					"400": {
						"description": "Bad request - Invalid or expired token"
					},
					"500": {
						"description": "Internal Server Error"
					}
				}
			}
		},
		"/v0/auth/forgot-password": {
			"post": {
				"tags": ["Auth"],
				"operationId": "auth_forgot_password",
				"requestBody": {
					"content": {
						"application/json": {
							"schema": {
								"$ref": "#/components/schemas/ForgotPasswordRequest"
							}
						}
					},
					"required": true
				},
				"responses": {
					"204": {
						"description": "Password reset email sent if account exists"
					},
					"400": {
						"description": "Bad request - Invalid JSON or validation error"
					},
					"500": {
						"description": "Internal Server Error"
					}
				}
			}
		},
		"/v0/auth/login": {
			"post": {
				"tags": ["Auth"],
				"operationId": "auth_login",
				"requestBody": {
					"content": {
						"application/json": {
							"schema": {
								"$ref": "#/components/schemas/LoginRequest"
							}
						}
					},
					"required": true
				},
				"responses": {
					"202": {
						"description": "TOTP required",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/TotpRequiredResponse"
								}
							}
						}
					},
					"204": {
						"description": "Login successful"
					},
					"400": {
						"description": "Bad request - Invalid JSON or validation error"
					},
					"401": {
						"description": "Unauthorized - Invalid credentials or password not set"
					},
					"404": {
						"description": "Not Found - User not found"
					},
					"500": {
						"description": "Internal Server Error - Database or Redis error"
					}
				}
			}
		},
		"/v0/auth/logout": {
			"post": {
				"tags": ["Auth"],
				"operationId": "auth_logout",
				"responses": {
					"204": {
						"description": "Logout successful"
					},
					"401": {
						"description": "Unauthorized - Invalid or expired session"
					},
					"500": {
						"description": "Internal Server Error - Redis error"
					}
				},
				"security": [
					{
						"session_id_cookie": []
					}
				]
			}
		},
		"/v0/auth/oauth/connections": {
			"get": {
				"tags": ["Auth"],
				"summary": "현재 사용자의 OAuth 연결 목록을 조회합니다.",
				"operationId": "list_oauth_connections",
				"responses": {
					"200": {
						"description": "OAuth connections list",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/OAuthConnectionListResponse"
								}
							}
						}
					},
					"401": {
						"description": "Unauthorized - Invalid or expired session"
					},
					"500": {
						"description": "Internal Server Error - Database error"
					}
				},
				"security": [
					{
						"session_id_cookie": []
					}
				]
			}
		},
		"/v0/auth/oauth/connections/unlink": {
			"post": {
				"tags": ["Auth"],
				"summary": "OAuth 연결을 해제합니다.",
				"operationId": "unlink_oauth_connection",
				"requestBody": {
					"content": {
						"application/json": {
							"schema": {
								"$ref": "#/components/schemas/UnlinkOAuthRequest"
							}
						}
					},
					"required": true
				},
				"responses": {
					"204": {
						"description": "OAuth unlinked successfully"
					},
					"400": {
						"description": "Bad request - Invalid JSON, validation error, or cannot unlink last authentication method"
					},
					"401": {
						"description": "Unauthorized - Invalid or expired session"
					},
					"404": {
						"description": "Not Found - User or OAuth connection not found"
					},
					"500": {
						"description": "Internal Server Error - Database error"
					}
				},
				"security": [
					{
						"session_id_cookie": []
					}
				]
			}
		},
		"/v0/auth/oauth/github/authorize": {
			"get": {
				"tags": ["Auth"],
				"summary": "GitHub OAuth 인증 URL을 생성합니다.",
				"operationId": "auth_github_authorize",
				"responses": {
					"200": {
						"description": "OAuth URL generated",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/OAuthUrlResponse"
								}
							}
						}
					},
					"500": {
						"description": "Internal Server Error - Redis or OAuth URL generation error"
					}
				}
			}
		},
		"/v0/auth/oauth/github/link": {
			"post": {
				"tags": ["Auth"],
				"summary": "GitHub OAuth를 현재 계정에 연결합니다.",
				"operationId": "auth_github_link",
				"requestBody": {
					"content": {
						"application/json": {
							"schema": {
								"$ref": "#/components/schemas/GithubLinkRequest"
							}
						}
					},
					"required": true
				},
				"responses": {
					"204": {
						"description": "OAuth linked successfully"
					},
					"400": {
						"description": "Bad request - Invalid JSON, validation error, invalid or expired state/code"
					},
					"401": {
						"description": "Unauthorized - Invalid or expired session"
					},
					"409": {
						"description": "Conflict - OAuth account already linked to this or another user"
					},
					"500": {
						"description": "Internal Server Error - Database, Redis, or OAuth provider error"
					}
				},
				"security": [
					{
						"session_id_cookie": []
					}
				]
			}
		},
		"/v0/auth/oauth/github/login": {
			"post": {
				"tags": ["Auth"],
				"summary": "GitHub OAuth 로그인을 처리합니다.",
				"description": "- 기존 사용자: 204 No Content + Set-Cookie\n- 신규 사용자: 200 OK + pending signup 정보 (complete-signup 필요)",
				"operationId": "auth_github_login",
				"requestBody": {
					"content": {
						"application/json": {
							"schema": {
								"$ref": "#/components/schemas/GithubLoginRequest"
							}
						}
					},
					"required": true
				},
				"responses": {
					"200": {
						"description": "New user - pending signup required",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/OAuthPendingSignupResponse"
								}
							}
						}
					},
					"204": {
						"description": "Login successful (existing user)"
					},
					"400": {
						"description": "Bad request - Invalid JSON, validation error, invalid/expired state/code, or no verified email"
					},
					"409": {
						"description": "Conflict - Email already exists"
					},
					"500": {
						"description": "Internal Server Error - Database, Redis, or OAuth provider error"
					}
				}
			}
		},
		"/v0/auth/oauth/google/authorize": {
			"get": {
				"tags": ["Auth"],
				"summary": "Google OAuth 인증 URL을 생성합니다.",
				"operationId": "auth_google_authorize",
				"responses": {
					"200": {
						"description": "OAuth URL generated",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/OAuthUrlResponse"
								}
							}
						}
					},
					"500": {
						"description": "Internal Server Error - Redis or OAuth URL generation error"
					}
				}
			}
		},
		"/v0/auth/oauth/google/link": {
			"post": {
				"tags": ["Auth"],
				"summary": "Google OAuth를 현재 계정에 연결합니다.",
				"operationId": "auth_google_link",
				"requestBody": {
					"content": {
						"application/json": {
							"schema": {
								"$ref": "#/components/schemas/GoogleLinkRequest"
							}
						}
					},
					"required": true
				},
				"responses": {
					"204": {
						"description": "OAuth linked successfully"
					},
					"400": {
						"description": "Bad request - Invalid JSON, validation error, invalid or expired state/code"
					},
					"401": {
						"description": "Unauthorized - Invalid or expired session"
					},
					"409": {
						"description": "Conflict - OAuth account already linked to this or another user"
					},
					"500": {
						"description": "Internal Server Error - Database, Redis, or OAuth provider error"
					}
				},
				"security": [
					{
						"session_id_cookie": []
					}
				]
			}
		},
		"/v0/auth/oauth/google/login": {
			"post": {
				"tags": ["Auth"],
				"summary": "Google OAuth 로그인을 처리합니다.",
				"description": "- 기존 사용자: 204 No Content + Set-Cookie\n- 신규 사용자: 200 OK + pending signup 정보 (complete-signup 필요)",
				"operationId": "auth_google_login",
				"requestBody": {
					"content": {
						"application/json": {
							"schema": {
								"$ref": "#/components/schemas/GoogleLoginRequest"
							}
						}
					},
					"required": true
				},
				"responses": {
					"200": {
						"description": "New user - pending signup required",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/OAuthPendingSignupResponse"
								}
							}
						}
					},
					"204": {
						"description": "Login successful (existing user)"
					},
					"400": {
						"description": "Bad request - Invalid JSON, validation error, or invalid/expired state/code"
					},
					"409": {
						"description": "Conflict - Email already exists"
					},
					"500": {
						"description": "Internal Server Error - Database, Redis, or OAuth provider error"
					}
				}
			}
		},
		"/v0/auth/resend-verification-email": {
			"post": {
				"tags": ["Auth"],
				"operationId": "auth_resend_verification_email",
				"responses": {
					"204": {
						"description": "Verification email sent successfully"
					},
					"401": {
						"description": "Unauthorized - Invalid or expired session, or OAuth user without password"
					},
					"404": {
						"description": "Not Found - User not found"
					},
					"409": {
						"description": "Conflict - Email already verified"
					},
					"500": {
						"description": "Internal Server Error - Database or Redis error"
					},
					"502": {
						"description": "Bad Gateway - Worker service request failed or returned invalid response"
					},
					"503": {
						"description": "Service Unavailable - Worker service connection failed"
					}
				},
				"security": [
					{
						"session_id_cookie": []
					}
				]
			}
		},
		"/v0/auth/reset-password": {
			"post": {
				"tags": ["Auth"],
				"operationId": "auth_reset_password",
				"requestBody": {
					"content": {
						"application/json": {
							"schema": {
								"$ref": "#/components/schemas/ResetPasswordRequest"
							}
						}
					},
					"required": true
				},
				"responses": {
					"204": {
						"description": "Password reset successfully"
					},
					"400": {
						"description": "Bad request - Invalid JSON, validation error, or invalid/expired token"
					},
					"500": {
						"description": "Internal Server Error"
					}
				}
			}
		},
		"/v0/auth/totp/backup-codes/regenerate": {
			"post": {
				"tags": ["Auth - TOTP"],
				"operationId": "totp_regenerate_backup_codes",
				"requestBody": {
					"content": {
						"application/json": {
							"schema": {
								"$ref": "#/components/schemas/TotpRegenerateBackupCodesRequest"
							}
						}
					},
					"required": true
				},
				"responses": {
					"200": {
						"description": "Backup codes regenerated",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/TotpBackupCodesResponse"
								}
							}
						}
					},
					"400": {
						"description": "Invalid TOTP code or TOTP not enabled"
					},
					"401": {
						"description": "Unauthorized"
					},
					"500": {
						"description": "Internal Server Error"
					}
				},
				"security": [
					{
						"session_id_cookie": []
					}
				]
			}
		},
		"/v0/auth/totp/disable": {
			"post": {
				"tags": ["Auth - TOTP"],
				"operationId": "totp_disable",
				"requestBody": {
					"content": {
						"application/json": {
							"schema": {
								"$ref": "#/components/schemas/TotpDisableRequest"
							}
						}
					},
					"required": true
				},
				"responses": {
					"204": {
						"description": "TOTP disabled"
					},
					"400": {
						"description": "Invalid TOTP code or TOTP not enabled"
					},
					"401": {
						"description": "Unauthorized"
					},
					"500": {
						"description": "Internal Server Error"
					}
				},
				"security": [
					{
						"session_id_cookie": []
					}
				]
			}
		},
		"/v0/auth/totp/enable": {
			"post": {
				"tags": ["Auth - TOTP"],
				"operationId": "totp_enable",
				"requestBody": {
					"content": {
						"application/json": {
							"schema": {
								"$ref": "#/components/schemas/TotpEnableRequest"
							}
						}
					},
					"required": true
				},
				"responses": {
					"200": {
						"description": "TOTP enabled",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/TotpEnableResponse"
								}
							}
						}
					},
					"400": {
						"description": "Invalid TOTP code"
					},
					"401": {
						"description": "Unauthorized"
					},
					"409": {
						"description": "TOTP already enabled"
					},
					"500": {
						"description": "Internal Server Error"
					}
				},
				"security": [
					{
						"session_id_cookie": []
					}
				]
			}
		},
		"/v0/auth/totp/setup": {
			"post": {
				"tags": ["Auth - TOTP"],
				"operationId": "totp_setup",
				"responses": {
					"200": {
						"description": "TOTP setup initiated",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/TotpSetupResponse"
								}
							}
						}
					},
					"401": {
						"description": "Unauthorized"
					},
					"409": {
						"description": "TOTP already enabled"
					},
					"500": {
						"description": "Internal Server Error"
					}
				},
				"security": [
					{
						"session_id_cookie": []
					}
				]
			}
		},
		"/v0/auth/totp/status": {
			"get": {
				"tags": ["Auth - TOTP"],
				"operationId": "totp_status",
				"responses": {
					"200": {
						"description": "TOTP status",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/TotpStatusResponse"
								}
							}
						}
					},
					"401": {
						"description": "Unauthorized"
					},
					"500": {
						"description": "Internal Server Error"
					}
				},
				"security": [
					{
						"session_id_cookie": []
					}
				]
			}
		},
		"/v0/auth/totp/verify": {
			"post": {
				"tags": ["Auth - TOTP"],
				"operationId": "totp_verify",
				"requestBody": {
					"content": {
						"application/json": {
							"schema": {
								"$ref": "#/components/schemas/TotpVerifyRequest"
							}
						}
					},
					"required": true
				},
				"responses": {
					"204": {
						"description": "TOTP verified, login successful"
					},
					"400": {
						"description": "Invalid TOTP code or temp token"
					},
					"500": {
						"description": "Internal Server Error"
					}
				}
			}
		},
		"/v0/auth/verify-email": {
			"post": {
				"tags": ["Auth"],
				"operationId": "auth_verify_email",
				"requestBody": {
					"content": {
						"application/json": {
							"schema": {
								"$ref": "#/components/schemas/VerifyEmailRequest"
							}
						}
					},
					"required": true
				},
				"responses": {
					"204": {
						"description": "Email verified successfully"
					},
					"400": {
						"description": "Bad request - Invalid JSON, validation error, invalid or expired token"
					},
					"404": {
						"description": "Not Found - User not found"
					},
					"409": {
						"description": "Conflict - Email already verified"
					},
					"500": {
						"description": "Internal Server Error - Database or Redis error"
					}
				}
			}
		},
		"/v0/eventstream/actions": {
			"get": {
				"tags": ["EventStream"],
				"operationId": "stream_actions",
				"parameters": [
					{
						"name": "user_id",
						"in": "query",
						"description": "Filter by user ID (for contributions)",
						"required": false,
						"schema": {
							"type": "string",
							"format": "uuid"
						}
					},
					{
						"name": "resource_id",
						"in": "query",
						"description": "Filter by resource ID",
						"required": false,
						"schema": {
							"type": "string",
							"format": "uuid"
						}
					},
					{
						"name": "resource_type",
						"in": "query",
						"description": "Filter by resource type",
						"required": false,
						"schema": {
							"$ref": "#/components/schemas/ActionResourceType"
						}
					},
					{
						"name": "actions",
						"in": "query",
						"description": "Filter by actions",
						"required": false,
						"schema": {
							"type": "array",
							"items": {
								"$ref": "#/components/schemas/ActionLogAction"
							}
						}
					}
				],
				"responses": {
					"200": {
						"description": "SSE stream of action logs",
						"content": {
							"text/event-stream": {}
						}
					}
				}
			}
		},
		"/v0/search/users": {
			"get": {
				"tags": ["Search"],
				"operationId": "search_users",
				"parameters": [
					{
						"name": "query",
						"in": "query",
						"description": "Search query for handle, display_name, or bio. Empty or omitted returns all users.",
						"required": false,
						"schema": {
							"type": "string"
						}
					},
					{
						"name": "page",
						"in": "query",
						"required": true,
						"schema": {
							"type": "integer",
							"format": "int32",
							"minimum": 0
						}
					},
					{
						"name": "page_size",
						"in": "query",
						"required": true,
						"schema": {
							"type": "integer",
							"format": "int32",
							"minimum": 0
						}
					}
				],
				"responses": {
					"200": {
						"description": "User search results",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/SearchUsersResponse"
								}
							}
						}
					},
					"400": {
						"description": "Bad request - Invalid query parameters or validation error"
					},
					"500": {
						"description": "Internal Server Error"
					}
				}
			}
		},
		"/v0/user/me": {
			"get": {
				"tags": ["User"],
				"operationId": "get_my_profile",
				"responses": {
					"200": {
						"description": "Current user info",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/UserResponse"
								}
							}
						}
					},
					"401": {
						"description": "Unauthorized - Invalid or expired session"
					},
					"500": {
						"description": "Internal Server Error - Database error"
					}
				},
				"security": [
					{
						"session_id_cookie": []
					}
				]
			},
			"patch": {
				"tags": ["User"],
				"operationId": "update_my_profile",
				"requestBody": {
					"content": {
						"application/json": {
							"schema": {
								"$ref": "#/components/schemas/UpdateMyProfileRequest"
							}
						}
					},
					"required": true
				},
				"responses": {
					"200": {
						"description": "Profile updated successfully",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/UserResponse"
								}
							}
						}
					},
					"400": {
						"description": "Bad Request - Validation error"
					},
					"401": {
						"description": "Unauthorized - Invalid or expired session"
					},
					"500": {
						"description": "Internal Server Error"
					}
				},
				"security": [
					{
						"session_id_cookie": []
					}
				]
			}
		},
		"/v0/user/me/banner-image": {
			"post": {
				"tags": ["User"],
				"operationId": "upload_banner_image",
				"requestBody": {
					"content": {
						"multipart/form-data": {
							"schema": {
								"$ref": "#/components/schemas/UploadUserImageRequest"
							}
						}
					},
					"required": true
				},
				"responses": {
					"201": {
						"description": "Banner image uploaded successfully",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/UploadUserImageResponse"
								}
							}
						}
					},
					"400": {
						"description": "Bad Request - Invalid image or validation error"
					},
					"401": {
						"description": "Unauthorized - Invalid or expired session"
					},
					"413": {
						"description": "Payload Too Large - Image exceeds size limit"
					},
					"500": {
						"description": "Internal Server Error"
					}
				},
				"security": [
					{
						"session_id_cookie": []
					}
				]
			},
			"delete": {
				"tags": ["User"],
				"operationId": "delete_banner_image",
				"responses": {
					"204": {
						"description": "Banner image deleted successfully"
					},
					"401": {
						"description": "Unauthorized - Invalid or expired session"
					},
					"404": {
						"description": "Not Found - No banner image to delete"
					},
					"500": {
						"description": "Internal Server Error"
					}
				},
				"security": [
					{
						"session_id_cookie": []
					}
				]
			}
		},
		"/v0/user/me/profile-image": {
			"post": {
				"tags": ["User"],
				"operationId": "upload_profile_image",
				"requestBody": {
					"content": {
						"multipart/form-data": {
							"schema": {
								"$ref": "#/components/schemas/UploadUserImageRequest"
							}
						}
					},
					"required": true
				},
				"responses": {
					"201": {
						"description": "Profile image uploaded successfully",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/UploadUserImageResponse"
								}
							}
						}
					},
					"400": {
						"description": "Bad Request - Invalid image or validation error"
					},
					"401": {
						"description": "Unauthorized - Invalid or expired session"
					},
					"413": {
						"description": "Payload Too Large - Image exceeds size limit"
					},
					"500": {
						"description": "Internal Server Error"
					}
				},
				"security": [
					{
						"session_id_cookie": []
					}
				]
			},
			"delete": {
				"tags": ["User"],
				"operationId": "delete_profile_image",
				"responses": {
					"204": {
						"description": "Profile image deleted successfully"
					},
					"401": {
						"description": "Unauthorized - Invalid or expired session"
					},
					"404": {
						"description": "Not Found - No profile image to delete"
					},
					"500": {
						"description": "Internal Server Error"
					}
				},
				"security": [
					{
						"session_id_cookie": []
					}
				]
			}
		},
		"/v0/users": {
			"post": {
				"tags": ["User"],
				"operationId": "create_user",
				"requestBody": {
					"content": {
						"application/json": {
							"schema": {
								"$ref": "#/components/schemas/CreateUserRequest"
							}
						}
					},
					"required": true
				},
				"responses": {
					"201": {
						"description": "User created successfully",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/CreateUserResponse"
								}
							}
						}
					},
					"400": {
						"description": "Bad request - Invalid JSON or validation error"
					},
					"409": {
						"description": "Conflict - User with this email or handle already exists"
					},
					"500": {
						"description": "Internal Server Error - Database or Redis error"
					},
					"502": {
						"description": "Bad Gateway - Worker service request failed or returned invalid response"
					},
					"503": {
						"description": "Service Unavailable - Worker service connection failed"
					}
				}
			}
		},
		"/v0/users/handle/{handle}/available": {
			"get": {
				"tags": ["User"],
				"operationId": "check_handle_available",
				"parameters": [
					{
						"name": "handle",
						"in": "path",
						"required": true,
						"schema": {
							"type": "string"
						}
					}
				],
				"responses": {
					"200": {
						"description": "Handle availability checked",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/CheckHandleAvailableResponse"
								}
							}
						}
					},
					"400": {
						"description": "Bad request - Invalid handle format"
					},
					"500": {
						"description": "Internal Server Error"
					}
				}
			}
		},
		"/v0/users/profile": {
			"get": {
				"tags": ["User"],
				"operationId": "get_user_profile",
				"parameters": [
					{
						"name": "handle",
						"in": "query",
						"required": true,
						"schema": {
							"type": "string"
						}
					}
				],
				"responses": {
					"200": {
						"description": "User profile retrieved successfully",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/PublicUserProfile"
								}
							}
						}
					},
					"400": {
						"description": "Bad request - Invalid query parameters"
					},
					"404": {
						"description": "Not Found - User not found"
					},
					"500": {
						"description": "Internal Server Error - Database error"
					}
				}
			}
		},
		"/v0/users/profile/id": {
			"get": {
				"tags": ["User"],
				"operationId": "get_user_profile_by_id",
				"parameters": [
					{
						"name": "user_id",
						"in": "query",
						"required": true,
						"schema": {
							"type": "string",
							"format": "uuid"
						}
					}
				],
				"responses": {
					"200": {
						"description": "User profile retrieved successfully",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/PublicUserProfile"
								}
							}
						}
					},
					"400": {
						"description": "Bad request - Invalid query parameters"
					},
					"404": {
						"description": "Not Found - User not found"
					},
					"500": {
						"description": "Internal Server Error - Database error"
					}
				}
			}
		}
	},
	"components": {
		"schemas": {
			"ActionLogAction": {
				"type": "string",
				"description": "Action Log Action enum (action_logs.action 필드에 저장됨)\n포맷: \"{resource}:{operation}\"",
				"enum": [
					"post:create",
					"post:edit",
					"post:delete",
					"user:create",
					"user:edit",
					"auth:login",
					"auth:logout",
					"auth:oauth_login",
					"oauth:link",
					"oauth:unlink"
				]
			},
			"ActionLogListResponse": {
				"type": "object",
				"required": ["data", "has_newer", "has_older"],
				"properties": {
					"data": {
						"type": "array",
						"items": {
							"$ref": "#/components/schemas/ActionLogResponse"
						}
					},
					"has_newer": {
						"type": "boolean",
						"description": "Whether there are newer (more recent) action logs"
					},
					"has_older": {
						"type": "boolean",
						"description": "Whether there are older action logs"
					}
				}
			},
			"ActionLogResponse": {
				"type": "object",
				"required": ["id", "action", "resource_type", "summary", "created_at"],
				"properties": {
					"action": {
						"type": "string"
					},
					"actor_id": {
						"type": ["string", "null"],
						"format": "uuid"
					},
					"actor_ip": {
						"type": ["string", "null"]
					},
					"created_at": {
						"type": "string",
						"format": "date-time"
					},
					"id": {
						"type": "string",
						"format": "uuid"
					},
					"metadata": {
						"type": ["object", "null"]
					},
					"resource_id": {
						"type": ["string", "null"],
						"format": "uuid"
					},
					"resource_type": {
						"$ref": "#/components/schemas/ActionResourceType"
					},
					"summary": {
						"type": "string"
					}
				}
			},
			"ActionResourceType": {
				"type": "string",
				"enum": ["User", "Post"]
			},
			"ChangeEmailRequest": {
				"type": "object",
				"required": ["password", "new_email"],
				"properties": {
					"new_email": {
						"type": "string",
						"description": "새 이메일 주소"
					},
					"password": {
						"type": "string",
						"description": "현재 비밀번호 (본인 확인용)"
					}
				}
			},
			"ChangePasswordRequest": {
				"type": "object",
				"required": ["current_password", "new_password"],
				"properties": {
					"current_password": {
						"type": "string",
						"description": "현재 비밀번호"
					},
					"new_password": {
						"type": "string",
						"description": "새 비밀번호"
					}
				}
			},
			"CheckHandleAvailablePath": {
				"type": "object",
				"required": ["handle"],
				"properties": {
					"handle": {
						"type": "string"
					}
				}
			},
			"CheckHandleAvailableResponse": {
				"type": "object",
				"required": ["available"],
				"properties": {
					"available": {
						"type": "boolean"
					}
				}
			},
			"CompleteSignupRequest": {
				"type": "object",
				"description": "OAuth pending signup 완료 요청",
				"required": ["pending_token", "handle"],
				"properties": {
					"handle": {
						"type": "string",
						"description": "사용자 핸들 (고유 식별자)"
					},
					"pending_token": {
						"type": "string",
						"description": "Pending signup 토큰 (OAuth 로그인 시 반환됨)"
					}
				}
			},
			"ConfirmEmailChangeRequest": {
				"type": "object",
				"required": ["token"],
				"properties": {
					"token": {
						"type": "string",
						"description": "이메일 변경 토큰 (이메일 링크의 ?token= 값)"
					}
				}
			},
			"CreateUserRequest": {
				"type": "object",
				"required": ["email", "handle", "display_name", "password"],
				"properties": {
					"display_name": {
						"type": "string"
					},
					"email": {
						"type": "string",
						"example": "user@example.com"
					},
					"handle": {
						"type": "string"
					},
					"password": {
						"type": "string"
					}
				}
			},
			"CreateUserResponse": {
				"type": "object",
				"required": ["message"],
				"properties": {
					"message": {
						"type": "string"
					}
				}
			},
			"CursorDirection": {
				"type": "string",
				"description": "Common cursor direction for bidirectional pagination",
				"enum": ["Older", "Newer"]
			},
			"ErrorResponse": {
				"type": "object",
				"required": ["status", "code"],
				"properties": {
					"code": {
						"type": "string"
					},
					"details": {
						"type": ["string", "null"]
					},
					"status": {
						"type": "integer",
						"format": "int32",
						"minimum": 0
					}
				}
			},
			"ForgotPasswordRequest": {
				"type": "object",
				"required": ["email"],
				"properties": {
					"email": {
						"type": "string",
						"description": "비밀번호 재설정을 요청할 이메일 주소"
					}
				}
			},
			"GetActionLogsRequest": {
				"type": "object",
				"required": ["limit"],
				"properties": {
					"actions": {
						"type": ["array", "null"],
						"items": {
							"$ref": "#/components/schemas/ActionLogAction"
						},
						"description": "Filter by actions"
					},
					"cursor_direction": {
						"oneOf": [
							{
								"type": "null"
							},
							{
								"$ref": "#/components/schemas/CursorDirection",
								"description": "Cursor direction (default: Older when cursor_id is provided)"
							}
						]
					},
					"cursor_id": {
						"type": ["string", "null"],
						"format": "uuid",
						"description": "Cursor ID for pagination. None means get latest."
					},
					"limit": {
						"type": "integer",
						"format": "int64",
						"description": "Number of items to return (max: 100)",
						"minimum": 0
					},
					"resource_id": {
						"type": ["string", "null"],
						"format": "uuid",
						"description": "Filter by resource ID"
					},
					"resource_type": {
						"oneOf": [
							{
								"type": "null"
							},
							{
								"$ref": "#/components/schemas/ActionResourceType",
								"description": "Filter by resource type"
							}
						]
					},
					"user_id": {
						"type": ["string", "null"],
						"format": "uuid",
						"description": "Filter by user ID (for contributions)"
					}
				}
			},
			"GetUserProfileByIdRequest": {
				"type": "object",
				"required": ["user_id"],
				"properties": {
					"user_id": {
						"type": "string",
						"format": "uuid"
					}
				}
			},
			"GetUserProfileRequest": {
				"type": "object",
				"required": ["handle"],
				"properties": {
					"handle": {
						"type": "string"
					}
				}
			},
			"GithubLinkRequest": {
				"type": "object",
				"description": "GitHub OAuth 연결 요청",
				"required": ["code", "state"],
				"properties": {
					"code": {
						"type": "string",
						"description": "Authorization code from GitHub OAuth callback"
					},
					"state": {
						"type": "string",
						"description": "State parameter for CSRF protection"
					}
				}
			},
			"GithubLoginRequest": {
				"type": "object",
				"description": "GitHub OAuth 로그인 요청",
				"required": ["code", "state"],
				"properties": {
					"code": {
						"type": "string",
						"description": "Authorization code from GitHub OAuth callback"
					},
					"state": {
						"type": "string",
						"description": "State parameter for CSRF protection"
					}
				}
			},
			"GoogleLinkRequest": {
				"type": "object",
				"description": "Google OAuth 연결 요청",
				"required": ["code", "state"],
				"properties": {
					"code": {
						"type": "string",
						"description": "Authorization code from Google OAuth callback"
					},
					"state": {
						"type": "string",
						"description": "State parameter for CSRF protection"
					}
				}
			},
			"GoogleLoginRequest": {
				"type": "object",
				"description": "Google OAuth 로그인 요청",
				"required": ["code", "state"],
				"properties": {
					"code": {
						"type": "string",
						"description": "Authorization code from Google OAuth callback"
					},
					"state": {
						"type": "string",
						"description": "State parameter for CSRF protection"
					}
				}
			},
			"LoginRequest": {
				"type": "object",
				"required": ["email", "password"],
				"properties": {
					"email": {
						"type": "string",
						"example": "user@example.com"
					},
					"password": {
						"type": "string"
					},
					"remember_me": {
						"type": "boolean",
						"description": "로그인 유지 여부 (체크 시 30일, 미체크 시 브라우저 닫으면 만료)",
						"example": false
					}
				}
			},
			"OAuthConnectionListResponse": {
				"type": "object",
				"description": "OAuth 연결 목록 응답",
				"required": ["connections"],
				"properties": {
					"connections": {
						"type": "array",
						"items": {
							"$ref": "#/components/schemas/OAuthConnectionResponse"
						}
					}
				}
			},
			"OAuthConnectionResponse": {
				"type": "object",
				"description": "OAuth 연결 정보 응답",
				"required": ["provider", "created_at"],
				"properties": {
					"created_at": {
						"type": "string",
						"format": "date-time",
						"description": "연결 생성 시각"
					},
					"provider": {
						"$ref": "#/components/schemas/OAuthProvider",
						"description": "OAuth provider (Google, Github)"
					}
				}
			},
			"OAuthPendingSignupResponse": {
				"type": "object",
				"description": "신규 사용자가 handle 없이 OAuth 로그인 시 반환되는 pending signup 응답",
				"required": ["pending_token", "email", "display_name"],
				"properties": {
					"display_name": {
						"type": "string",
						"description": "OAuth provider로부터 받은 표시 이름"
					},
					"email": {
						"type": "string",
						"description": "OAuth provider로부터 받은 이메일"
					},
					"pending_token": {
						"type": "string",
						"description": "Pending signup 완료를 위한 일회용 토큰"
					}
				}
			},
			"OAuthProvider": {
				"type": "string",
				"enum": ["Google", "Github", "Discord", "X", "Microsoft"]
			},
			"OAuthUrlResponse": {
				"type": "object",
				"description": "OAuth authorization URL 응답",
				"required": ["auth_url"],
				"properties": {
					"auth_url": {
						"type": "string",
						"description": "Google/GitHub OAuth authorization URL (state parameter 포함)"
					}
				}
			},
			"PublicUserProfile": {
				"type": "object",
				"required": ["id", "handle", "display_name", "is_verified", "created_at"],
				"properties": {
					"banner_image": {
						"type": ["string", "null"]
					},
					"bio": {
						"type": ["string", "null"]
					},
					"created_at": {
						"type": "string",
						"format": "date-time"
					},
					"display_name": {
						"type": "string"
					},
					"handle": {
						"type": "string"
					},
					"id": {
						"type": "string",
						"format": "uuid"
					},
					"is_verified": {
						"type": "boolean"
					},
					"profile_image": {
						"type": ["string", "null"]
					}
				}
			},
			"ResetPasswordRequest": {
				"type": "object",
				"required": ["token", "new_password"],
				"properties": {
					"new_password": {
						"type": "string",
						"description": "새 비밀번호"
					},
					"token": {
						"type": "string",
						"description": "비밀번호 재설정 토큰 (이메일 링크의 ?token= 값)"
					}
				}
			},
			"SearchUsersRequest": {
				"type": "object",
				"required": ["page", "page_size"],
				"properties": {
					"page": {
						"type": "integer",
						"format": "int32",
						"minimum": 0
					},
					"page_size": {
						"type": "integer",
						"format": "int32",
						"minimum": 0
					},
					"query": {
						"type": ["string", "null"],
						"description": "Search query for handle, display_name, or bio. Empty or omitted returns all users."
					}
				}
			},
			"SearchUsersResponse": {
				"type": "object",
				"required": ["users", "page", "page_size", "total_hits", "total_pages"],
				"properties": {
					"page": {
						"type": "integer",
						"format": "int32",
						"minimum": 0
					},
					"page_size": {
						"type": "integer",
						"format": "int32",
						"minimum": 0
					},
					"total_hits": {
						"type": "integer",
						"format": "int64",
						"minimum": 0
					},
					"total_pages": {
						"type": "integer",
						"format": "int32",
						"minimum": 0
					},
					"users": {
						"type": "array",
						"items": {
							"$ref": "#/components/schemas/UserSearchItem"
						}
					}
				}
			},
			"SortOrder": {
				"type": "string",
				"enum": ["Asc", "Desc"]
			},
			"TotpBackupCodesResponse": {
				"type": "object",
				"description": "백업 코드 재생성 응답",
				"required": ["backup_codes"],
				"properties": {
					"backup_codes": {
						"type": "array",
						"items": {
							"type": "string"
						},
						"description": "새로 생성된 백업 코드 목록 (10개, 8자리 영숫자)"
					}
				}
			},
			"TotpDisableRequest": {
				"type": "object",
				"description": "TOTP 비활성화 요청",
				"required": ["code"],
				"properties": {
					"code": {
						"type": "string",
						"description": "현재 TOTP 코드 (6자리) 또는 백업 코드 (8자리)"
					}
				}
			},
			"TotpEnableRequest": {
				"type": "object",
				"description": "TOTP 활성화 요청 (setup 후 첫 코드 검증)",
				"required": ["code"],
				"properties": {
					"code": {
						"type": "string",
						"description": "인증 앱에서 생성한 6자리 TOTP 코드"
					}
				}
			},
			"TotpEnableResponse": {
				"type": "object",
				"description": "TOTP 활성화 응답 (백업 코드 반환)",
				"required": ["backup_codes"],
				"properties": {
					"backup_codes": {
						"type": "array",
						"items": {
							"type": "string"
						},
						"description": "백업 코드 목록 (10개, 8자리 영숫자)"
					}
				}
			},
			"TotpRegenerateBackupCodesRequest": {
				"type": "object",
				"description": "백업 코드 재생성 요청",
				"required": ["code"],
				"properties": {
					"code": {
						"type": "string",
						"description": "현재 TOTP 코드 (6자리)"
					}
				}
			},
			"TotpRequiredResponse": {
				"type": "object",
				"description": "로그인 시 TOTP 필요 응답 (202 Accepted)",
				"required": ["temp_token"],
				"properties": {
					"temp_token": {
						"type": "string",
						"description": "TOTP 검증용 임시 토큰"
					}
				}
			},
			"TotpSetupResponse": {
				"type": "object",
				"description": "TOTP Setup 응답",
				"required": ["qr_code_base64", "qr_code_uri"],
				"properties": {
					"qr_code_base64": {
						"type": "string",
						"description": "QR 코드 PNG 이미지 (Base64 인코딩)"
					},
					"qr_code_uri": {
						"type": "string",
						"description": "otpauth:// URI (수동 입력용)"
					}
				}
			},
			"TotpStatusResponse": {
				"type": "object",
				"description": "TOTP 상태 응답",
				"required": ["enabled"],
				"properties": {
					"backup_codes_remaining": {
						"type": ["integer", "null"],
						"description": "남은 백업 코드 수 (활성화된 경우만)",
						"minimum": 0
					},
					"enabled": {
						"type": "boolean",
						"description": "TOTP 활성화 여부"
					},
					"enabled_at": {
						"type": ["string", "null"],
						"format": "date-time",
						"description": "TOTP 활성화 시각 (활성화된 경우만)"
					}
				}
			},
			"TotpVerifyRequest": {
				"type": "object",
				"description": "TOTP 검증 요청 (로그인 시 2단계 인증)",
				"required": ["temp_token", "code"],
				"properties": {
					"code": {
						"type": "string",
						"description": "TOTP 코드 (6자리) 또는 백업 코드 (8자리)"
					},
					"temp_token": {
						"type": "string",
						"description": "로그인 시 받은 임시 토큰"
					}
				}
			},
			"UnlinkOAuthRequest": {
				"type": "object",
				"description": "OAuth 연결 해제 요청",
				"required": ["provider"],
				"properties": {
					"provider": {
						"$ref": "#/components/schemas/OAuthProvider",
						"description": "OAuth provider to unlink (Google or Github)"
					}
				}
			},
			"UpdateMyProfileRequest": {
				"type": "object",
				"properties": {
					"bio": {
						"type": ["string", "null"]
					},
					"display_name": {
						"type": ["string", "null"]
					}
				}
			},
			"UploadUserImageRequest": {
				"type": "object",
				"required": ["file"],
				"properties": {
					"file": {
						"type": "string",
						"format": "binary",
						"description": "Image file binary data",
						"contentMediaType": "image/*"
					}
				}
			},
			"UploadUserImageResponse": {
				"type": "object",
				"required": ["image_url"],
				"properties": {
					"image_url": {
						"type": "string",
						"description": "URL of the uploaded image"
					}
				}
			},
			"UserResponse": {
				"type": "object",
				"required": ["id", "email", "handle", "display_name", "is_verified", "created_at"],
				"properties": {
					"banner_image": {
						"type": ["string", "null"]
					},
					"bio": {
						"type": ["string", "null"]
					},
					"created_at": {
						"type": "string",
						"format": "date-time"
					},
					"display_name": {
						"type": "string"
					},
					"email": {
						"type": "string"
					},
					"handle": {
						"type": "string"
					},
					"id": {
						"type": "string",
						"format": "uuid"
					},
					"is_verified": {
						"type": "boolean"
					},
					"profile_image": {
						"type": ["string", "null"]
					}
				}
			},
			"UserSearchItem": {
				"type": "object",
				"required": ["id", "handle", "display_name"],
				"properties": {
					"bio": {
						"type": ["string", "null"]
					},
					"display_name": {
						"type": "string"
					},
					"handle": {
						"type": "string"
					},
					"id": {
						"type": "string",
						"format": "uuid"
					},
					"profile_image": {
						"type": ["string", "null"]
					}
				}
			},
			"VerifyEmailRequest": {
				"type": "object",
				"required": ["token"],
				"properties": {
					"token": {
						"type": "string",
						"description": "이메일 인증 토큰"
					}
				}
			}
		},
		"securitySchemes": {
			"anonymous_id_cookie": {
				"type": "apiKey",
				"in": "cookie",
				"name": "anonymous_user_id"
			},
			"session_id_cookie": {
				"type": "apiKey",
				"in": "cookie",
				"name": "session_id"
			}
		}
	},
	"tags": [
		{
			"name": "Health",
			"description": "Health endpoints"
		},
		{
			"name": "Auth",
			"description": "Authentication endpoints"
		},
		{
			"name": "User",
			"description": "User endpoints"
		},
		{
			"name": "Search",
			"description": "Search endpoints"
		},
		{
			"name": "Action Logs",
			"description": "User activity logs"
		}
	]
}
